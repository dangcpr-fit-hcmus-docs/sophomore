CREATE DATABASE QLGiaoVien
USE QLGiaoVien
GO
CREATE TABLE GIAOVIEN (
	MAGV nchar(8),
	HOTEN nchar(30),
	LUONG float,
	PHAI nchar(3),
	NGSINH date,
	DIACHI nchar(50),
	GVQLCM nchar(8),
	MABM nchar(8),
	PRIMARY KEY (MAGV)
)

CREATE TABLE BOMON (
	MABM nchar(8),
	TENBM nchar(20),
	PHONG nchar(10),
	DIENTHOAI nchar(10),
	TRUONGBM nchar(8),
	MAKHOA nchar(8),
	NGAYNHANCHUC date,
	PRIMARY KEY (MABM)
)

CREATE TABLE KHOA (
	MAKHOA nchar(8),
	TENKHOA nchar(20),
	NAMTL int,
	PHONG nchar(10),
	DIENTHOAI nchar(10),
	TRUONGKHOA nchar(8),
	NGAYNHANCHUC date,
	PRIMARY KEY (MAKHOA)
)

CREATE TABLE GV_DT (
	MAGV nchar(8),
	DIENTHOAI nchar(10),
	PRIMARY KEY (MAGV, DIENTHOAI)
)

CREATE TABLE NGUOITHAN (
	MAGV nchar(8),
	TEN nchar(30),
	NGSINH date,
	PHAI nchar(3)
	PRIMARY KEY (MAGV, TEN)
)

CREATE TABLE THAMGIADT (
	MAGV nchar(8),
	MADT nchar(8),
	STT numeric,
	PHUCAP numeric,
	KETQUA nchar(8)
	PRIMARY KEY (MAGV, MADT, STT)
)

CREATE TABLE CONGVIEC (
	MADT nchar(8),
	SOTT numeric,
	TENCV nchar(30),
	NGAYBD date,
	NGAYKT date
	PRIMARY KEY (MADT, SOTT)
)

CREATE TABLE DETAI (
	MADT nchar(8),
	TENDT nchar(20),
	CAPQL nchar(8),
	KINHPHI numeric,
	NGAYBD date,
	NGAYKT date,
	MACD nchar(8),
	GVCNDT nchar(8)
	PRIMARY KEY (MADT)
)

CREATE TABLE CHUDE (
	MACD nchar(8),
	TENCD nchar(20)
	PRIMARY KEY (MACD)
)

ALTER TABLE GIAOVIEN
ADD CONSTRAINT C_PHAI
CHECK (PHAI IN ('Nam', N'Nữ'))

ALTER TABLE GIAOVIEN
ADD CONSTRAINT FK_GVQLCM_MAGV
FOREIGN KEY (GVQLCM)
REFERENCES GIAOVIEN(MAGV)

ALTER TABLE GIAOVIEN
ADD CONSTRAINT FK_MABM_MABM
FOREIGN KEY (MABM)
REFERENCES BOMON(MABM)

ALTER TABLE BOMON
ADD CONSTRAINT FK_MAKHOA_MAKHOA
FOREIGN KEY (MAKHOA)
REFERENCES KHOA(MAKHOA)

ALTER TABLE BOMON
ADD CONSTRAINT FK_TRUONGBM_MAGV
FOREIGN KEY (TRUONGBM)
REFERENCES GIAOVIEN(MAGV)

ALTER TABLE KHOA
ADD CONSTRAINT FK_KHOA_GIAOVIEN
FOREIGN KEY (TRUONGKHOA)
REFERENCES GIAOVIEN(MAGV)

ALTER TABLE GV_DT
ADD CONSTRAINT FK_GVDT_GIAOVIEN
FOREIGN KEY (MAGV)
REFERENCES GIAOVIEN(MAGV)

ALTER TABLE NGUOITHAN
ADD CONSTRAINT FK_NGUOITHAN_GIAOVIEN
FOREIGN KEY (MAGV)
REFERENCES GIAOVIEN(MAGV)

ALTER TABLE NGUOITHAN
ADD CONSTRAINT C_PHAI_NT
CHECK (PHAI IN ('Nam', N'Nữ'))

ALTER TABLE THAMGIADT
ADD CONSTRAINT FK_TGDTMAGV_GVMAGV
FOREIGN KEY (MAGV)
REFERENCES GIAOVIEN(MAGV)

ALTER TABLE THAMGIADT
ADD CONSTRAINT FK_TGDTMADTSTT_CVMADTSOTT
FOREIGN KEY (MADT, STT)
REFERENCES CONGVIEC(MADT, SOTT)

ALTER TABLE CONGVIEC
ADD CONSTRAINT FK_CVMADT_DTMADT
FOREIGN KEY (MADT)
REFERENCES DETAI(MADT)

ALTER TABLE DETAI
ADD CONSTRAINT FK_DTGVCNDT_GVMAGV
FOREIGN KEY (GVCNDT)
REFERENCES GIAOVIEN(MAGV)

ALTER TABLE DETAI
ADD CONSTRAINT FK_DTMACD_CDMACD
FOREIGN KEY (MACD)
REFERENCES CHUDE(MACD)

INSERT INTO GIAOVIEN VALUES ('00000001', N'Nguyễn Văn A', 10000000, 'Nam', '01/01/1990', N'01A', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('00000002', N'Nguyễn Văn B', 10500000, N'Nữ', '01/02/1990', N'01B', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('00000003', N'Nguyễn Văn C', 11000000, 'Nam', '01/03/1990', N'01C', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('00000004', N'Nguyễn Văn D', 11500000,	N'Nữ', '01/03/1990', N'01D', NULL, NULL)

INSERT INTO BOMON VALUES ('KTPM', N'Kỹ thuật phần mềm', 'I46', '0789654321', '00000004', NULL, '01/01/2008')
INSERT INTO BOMON VALUES ('HTTT', N'Hệ thống thông tin', 'I47', '0897654321', '00000001', NULL, '01/01/2008')
INSERT INTO BOMON VALUES ('MMT', N'Mạng máy tính', 'I48', '0987654321', '00000002', NULL, '01/01/2008')
INSERT INTO BOMON VALUES ('TGMT', N'Thị giác máy tính', 'I49', '0987645321', '00000002', NULL, '01/01/2008')

INSERT INTO KHOA VALUES ('CNTT', N'Công nghệ thông tin', 1985, 'I46', '0123456789', '00000004', '01/01/2007')
INSERT INTO KHOA VALUES ('VLH', N'Vật lý', 1985, 'I46', '0123456789', '00000002', '01/01/2007')
INSERT INTO KHOA VALUES ('MT', N'Môi trường', 1985, 'I46', '0123456789', '00000002', '01/01/2007')


SELECT * FROM GIAOVIEN

UPDATE GIAOVIEN
SET GVQLCM = '00000003', MABM='KTPM'
WHERE MAGV = '00000001'

UPDATE GIAOVIEN
SET GVQLCM = '00000004', MABM='HTTT'
WHERE MAGV = '00000002'

UPDATE GIAOVIEN
SET MABM='MMT'
WHERE MAGV = '00000003'

UPDATE GIAOVIEN
SET MABM='TGMT'
WHERE MAGV = '00000004'

UPDATE BOMON
SET MAKHOA='CNTT'
WHERE MABM='KTPM' OR MABM = 'HTTT' OR MABM = 'TGMT'

UPDATE BOMON
SET MAKHOA='VLH'
WHERE MABM='MMT'

INSERT INTO NGUOITHAN VALUES ('00000001', N'Nguyễn Thị A', '01/01/1975', 'Nam')
INSERT INTO NGUOITHAN VALUES ('00000002', N'Nguyễn Thị B', '02/01/1975', N'Nữ')
INSERT INTO NGUOITHAN VALUES ('00000003', N'Nguyễn Thị C', '03/01/1975', N'Nữ')
INSERT INTO NGUOITHAN VALUES ('00000004', N'Nguyễn Thị C', '03/01/1975', N'Nữ')
INSERT INTO NGUOITHAN VALUES ('00000004', N'Nguyễn Thị E', '03/01/2022', N'Nữ')

INSERT INTO GV_DT VALUES ('00000001', '0123456789')
INSERT INTO GV_DT VALUES ('00000002', '0210830039')
INSERT INTO GV_DT VALUES ('00000002', '0987654321')

INSERT INTO CHUDE VALUES ('CS101', N'Nhập môn lập trình')
INSERT INTO CHUDE VALUES ('CS102', N'Kỹ thuật lập trình')
INSERT INTO CHUDE VALUES ('CS106', N'Cơ sở dữ liệu')

INSERT INTO DETAI VALUES ('K001', N'Mảng tĩnh', N'Khoa', 3000000, '01/01/2021', '12/31/2021', 'CS101', '00000001')
INSERT INTO DETAI VALUES ('K002', N'Mảng động', N'Trường', 5000000, '01/01/2022', '05/31/2022', 'CS102', '00000002')
INSERT INTO DETAI VALUES ('K003', N'Danh sách liên kết', N'Khoa', 3500000, '05/01/2022', '11/30/2022', 'CS102', '00000002')
INSERT INTO DETAI VALUES ('K004', N'Ràng buộc toàn vẹn', N'Trường', 7000000, '04/01/2022', '10/31/2022', 'CS106', '00000004')

INSERT INTO CONGVIEC VALUES ('K001', 1, N'Toán tử []', '01/01/2021', '04/01/2021')
INSERT INTO CONGVIEC VALUES ('K002', 1, N'Toán tử *', '01/01/2022', '03/31/2022')
INSERT INTO CONGVIEC VALUES ('K002', 2, N'Con trỏ an toàn', '04/01/2022', '05/31/2022')
INSERT INTO CONGVIEC VALUES ('K003', 1, N'Tập hợp tuyến tính', '05/01/2022', '09/30/2022')
INSERT INTO CONGVIEC VALUES ('K003', 2, N'Cấu trúc một node', '10/01/2022', '11/30/2022')
INSERT INTO CONGVIEC VALUES ('K004', 1, N'Các loại ràng buộc', '04/01/2022', '08/31/2022')

INSERT INTO THAMGIADT VALUES ('00000001', 'K001', 1, 200000, N'Giỏi')
INSERT INTO THAMGIADT VALUES ('00000002', 'K002', 1, 500000, N'Xuất sắc')
INSERT INTO THAMGIADT VALUES ('00000002', 'K002', 2, 450000, N'Khá')
INSERT INTO THAMGIADT VALUES ('00000003', 'K003', 2, 400000, N'Khá')
INSERT INTO THAMGIADT VALUES ('00000004', 'K004', 1, 475000, N'Giỏi')